defmodule ExWebRTC.RTP.H264Test do
  use ExUnit.Case, async: true

  alias ExRTP.Packet
  alias ExWebRTC.RTP.H264

  test "keyframe?/1" do
    # from https://github.com/jech/galene/blob/master/codecs/codecs_test.go
    binary1 =
      <<0x80, 0xE6, 0xF, 0xAE, 0xFA, 0x86, 0x3B, 0x49, 0x59, 0xBD, 0x79, 0xE7, 0x78, 0x0, 0xC,
        0x67, 0x42, 0xC0, 0xC, 0x8C, 0x8D, 0x4E, 0x40, 0x3C, 0x22, 0x11, 0xA8, 0x0, 0x4, 0x68,
        0xCE, 0x3C, 0x80, 0x0, 0x1A, 0x65, 0xB8, 0x0, 0x4, 0x0, 0x0, 0x9, 0xE3, 0x31, 0x40, 0x0,
        0x46, 0x76, 0x38, 0x0, 0x8, 0x2, 0x47, 0x0, 0x2, 0x7F, 0x3F, 0x77, 0x6F, 0x67, 0x80>>

    {:ok, packet1} = Packet.decode(binary1)
    assert H264.keyframe?(packet1)

    binary2 =
      <<0x80, 0xE6, 0xF, 0xAF, 0xFA, 0x86, 0x46, 0x89, 0x59, 0xBD, 0x79, 0xE7, 0x61, 0xE0, 0x0,
        0x40, 0x0, 0xBE, 0x40, 0x9E, 0xA0>>

    {:ok, packet2} = Packet.decode(binary2)
    assert not H264.keyframe?(packet2)
  end
end
